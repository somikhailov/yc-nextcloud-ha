---
- name: etcd
  hosts: etcd
  become: true

  roles:
    - etcd
  tags: etcd

- name: postgres
  hosts: db
  become: true

  roles:
    - postgres
  tags: postgres

- name: nginx
  hosts: app_proxy
  become: true
  vars:
    domain_name: ${ domain_name }
    backend_servers: "{{ groups['app'] | map('extract', hostvars, ['ansible_host']) }}"    
  roles:
    - nginx
  tags: nginx

- name: Nextcloud
  hosts: app
  become: true
  vars:
    postgres_host: ${ postgres_host }

  roles:
    - nextcloud
  tags: nextcloud